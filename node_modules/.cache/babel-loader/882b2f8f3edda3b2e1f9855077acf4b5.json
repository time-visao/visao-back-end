{"ast":null,"code":"import _regeneratorRuntime from \"/home/lorensov/projects/hub/visao/visao-rappel/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/lorensov/projects/hub/visao/visao-rappel/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { LOGIN_REQUEST, LOGIN_SUCCESS, LOGIN_FAILURE, LOGIN_UNAUTHORIZED, LOGOUT } from './types';\nimport api from '../services/api'; //FACEBOOK RESPONSE AND LOGIN\n\nexport var handleFacebookLogin = function handleFacebookLogin(res) {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(dispatch) {\n        var last_name, first_name, body_post, urlLogin;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                dispatch({\n                  type: LOGIN_REQUEST\n                });\n\n                if (!res.accessToken) {\n                  _context.next = 10;\n                  break;\n                }\n\n                last_name = res.name.substr(res.name.indexOf(' ') + 1); //Extract the first name as the  substring before the first space\n\n                first_name = res.name.substr(0, res.name.indexOf(' ') + 1); //Extract the last name as the  substring after the first space\n\n                body_post = {\n                  profile: {\n                    id: res.userID,\n                    first_name: first_name,\n                    last_name: last_name,\n                    email: res.email\n                  }\n                };\n                urlLogin = '/auth/users/facebook';\n                _context.next = 8;\n                return api.post(urlLogin, body_post).then(function (res2) {\n                  localStorage.setItem('auth_token', res2.data.jwt);\n                  window.location.href = '../portal/';\n                }).catch(function (error) {\n                  console.log(error);\n                  dispatch({\n                    type: LOGIN_FAILURE\n                  });\n                });\n\n              case 8:\n                _context.next = 12;\n                break;\n\n              case 10:\n                console.log('Erro no login');\n                dispatch({\n                  type: LOGIN_FAILURE\n                });\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }()\n  );\n};\nexport var handleSubmit = function handleSubmit(email, password) {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(dispatch) {\n        var body_post, urlLogin;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                dispatch({\n                  type: LOGIN_REQUEST\n                });\n                body_post = {\n                  email: email,\n                  password: password\n                };\n                urlLogin = '/auth/users/login';\n                _context2.next = 5;\n                return api.post(urlLogin, {\n                  email: body_post.email,\n                  password: body_post.password\n                }).then(function (res) {\n                  localStorage.setItem('auth_token', res.data.jwt);\n                  window.location.href = '../portal/';\n                }).catch(function (error) {\n                  console.log(error);\n                  dispatch({\n                    type: LOGIN_FAILURE\n                  });\n                });\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function (_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }()\n  );\n};\nexport var getAuthUserRequest = function getAuthUserRequest() {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(dispatch) {\n        var urlAuth;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                urlAuth = '/user/inhabitants/me';\n                _context3.next = 3;\n                return api.get(urlAuth).then(function (res) {\n                  // console.log(res);      \n                  if (res.data.data.attributes.coworker) {\n                    dispatch({\n                      type: LOGIN_SUCCESS,\n                      payload: res.data.data\n                    }); // window.location.href = '../portal';\n                  } else {\n                    console.log('Usuario nao autorizado');\n                    dispatch({\n                      type: LOGIN_UNAUTHORIZED\n                    });\n                  }\n                }).catch(function (e) {\n                  console.log(e);\n                  dispatch({\n                    type: LOGIN_FAILURE\n                  });\n                });\n\n              case 3:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      return function (_x3) {\n        return _ref3.apply(this, arguments);\n      };\n    }()\n  );\n};\nexport var handleLogout = function handleLogout() {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref4 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(dispatch) {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                localStorage.removeItem('auth_token');\n                window.location.href = '../login';\n                dispatch({\n                  type: LOGOUT\n                });\n\n              case 3:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      return function (_x4) {\n        return _ref4.apply(this, arguments);\n      };\n    }()\n  );\n};","map":{"version":3,"sources":["/home/lorensov/projects/hub/visao/visao-rappel/src/actions/LoginAction.js"],"names":["LOGIN_REQUEST","LOGIN_SUCCESS","LOGIN_FAILURE","LOGIN_UNAUTHORIZED","LOGOUT","api","handleFacebookLogin","res","dispatch","type","accessToken","last_name","name","substr","indexOf","first_name","body_post","profile","id","userID","email","urlLogin","post","then","res2","localStorage","setItem","data","jwt","window","location","href","catch","error","console","log","handleSubmit","password","getAuthUserRequest","urlAuth","get","attributes","coworker","payload","e","handleLogout","removeItem"],"mappings":"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","sourcesContent":["import { LOGIN_REQUEST, LOGIN_SUCCESS, LOGIN_FAILURE, LOGIN_UNAUTHORIZED, LOGOUT } from './types';\nimport api from '../services/api';\n\n//FACEBOOK RESPONSE AND LOGIN\nexport const handleFacebookLogin = res => async dispatch => {\n  dispatch({ type: LOGIN_REQUEST });\n  if (res.accessToken) {\n    var last_name = res.name.substr(res.name.indexOf(' ') + 1); //Extract the first name as the  substring before the first space\n    var first_name = res.name.substr(0, res.name.indexOf(' ') + 1); //Extract the last name as the  substring after the first space\n    var body_post = {\n      profile: {\n        id: res.userID,\n        first_name: first_name,\n        last_name: last_name,\n        email: res.email,\n      },\n    };\n    const urlLogin = '/auth/users/facebook';\n    await api\n      .post(urlLogin, body_post)\n      .then(res2 => {\n        localStorage.setItem('auth_token', res2.data.jwt);\n        window.location.href = '../portal/';\n      })\n      .catch(error => {\n        console.log(error);\n        dispatch({ type: LOGIN_FAILURE });\n      });\n  } else {\n    console.log('Erro no login');\n    dispatch({ type: LOGIN_FAILURE });\n  }\n};\n\nexport const handleSubmit = (email, password) => async dispatch => {\n  dispatch({ type: LOGIN_REQUEST });\n  var body_post = {\n    email: email,\n    password: password,\n  };\n  const urlLogin = '/auth/users/login';\n  await api\n    .post(urlLogin, { email: body_post.email, password: body_post.password })\n    .then(res => {\n      localStorage.setItem('auth_token', res.data.jwt);\n      window.location.href = '../portal/';\n    })\n    .catch(error => {\n      console.log(error);\n      dispatch({ type: LOGIN_FAILURE });\n    });\n};\n\nexport const getAuthUserRequest = () => async dispatch => {\n  const urlAuth = '/user/inhabitants/me';\n  await api\n    .get(urlAuth)\n    .then(res => {\n      // console.log(res);      \n      if (res.data.data.attributes.coworker) {\n        dispatch({ type: LOGIN_SUCCESS, payload: res.data.data });\n        // window.location.href = '../portal';\n      } else {\n        console.log('Usuario nao autorizado');\n        dispatch({ type: LOGIN_UNAUTHORIZED });\n      }\n    })\n    .catch(e => {\n      console.log(e);\n      dispatch({ type: LOGIN_FAILURE });\n    });\n};\n\nexport const handleLogout = () => async dispatch => {\n  localStorage.removeItem('auth_token');\n  window.location.href = '../login';\n  dispatch({ type: LOGOUT });\n};\n"]},"metadata":{},"sourceType":"module"}